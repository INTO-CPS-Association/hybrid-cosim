# Makefile generated by OpenModelica
CC=@CC@
AR=@AR@
CFLAGS=@CFLAGS@
LD=$(CC) -shared
LDFLAGS=@LDFLAGS@ @LIBS@
DLLEXT=@DLLEXT@
NEED_RUNTIME=@NEED_RUNTIME@
NEED_DGESV=@NEED_DGESV@
FMIPLATFORM=@FMIPLATFORM@
# Note: Simulation of the fmu with dymola does not work with -finline-small-functions (enabled by most optimization levels)
CPPFLAGS=@CPPFLAGS@
OMC_NUM_LINEAR_SYSTEMS=6
OMC_NUM_NONLINEAR_SYSTEMS=0
OMC_NUM_MIXED_SYSTEMS=0
OMC_NDELAY_EXPRESSIONS=0
OMC_NVAR_STRING=0

override CPPFLAGS += -Iinclude/ -Iinclude/fmi2 -I.    -DOMC_MODEL_PREFIX=PW_PowerSystem -DOMC_NUM_MIXED_SYSTEMS=0 -DOMC_NUM_LINEAR_SYSTEMS=6 -DOMC_NUM_NONLINEAR_SYSTEMS=0 -DOMC_NDELAY_EXPRESSIONS=0 -DOMC_NVAR_STRING=0

MAINFILE=PW_PowerSystem_FMU.c
MAINOBJ=PW_PowerSystem_FMU.o
CFILES=PW_PowerSystem.c PW_PowerSystem_functions.c PW_PowerSystem_records.c \
PW_PowerSystem_01exo.c PW_PowerSystem_02nls.c PW_PowerSystem_03lsy.c PW_PowerSystem_04set.c PW_PowerSystem_05evt.c PW_PowerSystem_06inz.c PW_PowerSystem_07dly.c \
PW_PowerSystem_08bnd.c PW_PowerSystem_09alg.c PW_PowerSystem_10asr.c PW_PowerSystem_11mix.c PW_PowerSystem_12jac.c PW_PowerSystem_13opt.c PW_PowerSystem_14lnz.c \
PW_PowerSystem_15syn.c PW_PowerSystem_16dae.c PW_PowerSystem_init_fmu.c
OFILES=$(CFILES:.c=.o)
GENERATEDFILES=$(MAINFILE) PW_PowerSystem_FMU.makefile PW_PowerSystem_literals.h PW_PowerSystem_model.h PW_PowerSystem_includes.h PW_PowerSystem_functions.h  PW_PowerSystem_11mix.h PW_PowerSystem_12jac.h PW_PowerSystem_13opt.h PW_PowerSystem_init_fmu.c PW_PowerSystem_info.c $(CFILES) PW_PowerSystem_FMU.libs

# FIXME: before you push into master...
RUNTIMEDIR=include
OMC_MINIMAL_RUNTIME=1
OMC_FMI_RUNTIME=1
include $(RUNTIMEDIR)/Makefile.objs
ifneq ($(NEED_RUNTIME),)
RUNTIMEFILES=$(FMI_ME_OBJS:%=$(RUNTIMEDIR)/%.o)
endif

PHONY: PW_PowerSystem_FMU
PW_PowerSystem_FMU: $(MAINOBJ) PW_PowerSystem_functions.h PW_PowerSystem_literals.h $(OFILES) $(RUNTIMEFILES)
	$(CXX) -shared -I. -o PW_PowerSystem$(DLLEXT) $(MAINOBJ) $(RUNTIMEFILES) $(OFILES) $(CPPFLAGS) -L"C:/Users/clagms/Source Control/Git_HybridCosimulation/ModelicaModels"   $(CFLAGS) $(LDFLAGS) -llis -Wl,--kill-at
	mkdir.exe -p ../binaries/win32
	dlltool -d PW_PowerSystem.def --dllname PW_PowerSystem$(DLLEXT) --output-lib PW_PowerSystem.lib --kill-at
	cp PW_PowerSystem$(DLLEXT) PW_PowerSystem.lib PW_PowerSystem_FMU.libs ../binaries/win32/
	cp C:/OpenModelica1.12.0-dev-32bit//bin/libsundials_*.dll ../binaries/win32/
	cp C:/OpenModelica1.12.0-dev-32bit//bin/libopenblas.dll ../binaries/win32/
	cp C:/OpenModelica1.12.0-dev-32bit//bin/libexpat*.dll ../binaries/win32/
	cp C:/OpenModelica1.12.0-dev-32bit//bin/libgfortran*.dll ../binaries/win32/
	cp C:/OpenModelica1.12.0-dev-32bit//bin/libquadmath*.dll ../binaries/win32/
	cp C:/OpenModelica1.12.0-dev-32bit//bin/libwinpthread*.dll ../binaries/win32/
	cp C:/OpenModelica1.12.0-dev-32bit//bin/zlib*.dll ../binaries/win32/
	cp C:/OpenModelica1.12.0-dev-32bit//bin/libszip*.dll ../binaries/win32/
	cp C:/OpenModelica1.12.0-dev-32bit//bin/libhdf5*.dll ../binaries/win32/
	cp C:/OpenModelica1.12.0-dev-32bit//bin/libsystre*.dll ../binaries/win32/
	cp C:/OpenModelica1.12.0-dev-32bit//bin/libtre*.dll ../binaries/win32/
	cp C:/OpenModelica1.12.0-dev-32bit//bin/libintl*.dll ../binaries/win32/
	cp C:/OpenModelica1.12.0-dev-32bit//bin/libiconv*.dll ../binaries/win32/
	cp C:/OpenModelica1.12.0-dev-32bit//bin/libgcc_s_*.dll ../binaries/win32/
	cp C:/OpenModelica1.12.0-dev-32bit//bin/libstdc*.dll ../binaries/win32/
	rm -f PW_PowerSystem.def PW_PowerSystem.o PW_PowerSystem$(DLLEXT) $(OFILES) $(RUNTIMEFILES)
	cd .. && rm -f ../PW_PowerSystem.fmu && zip -r ../PW_PowerSystem.fmu *

